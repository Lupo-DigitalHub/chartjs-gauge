/*!
 * chartjs-gauge-v3 v3.0.0
 * https://uk-taniyama.github.io/chartjs-gauge/
 * (c) 2023 chartjs-gauge-v3 Contributors
 * Released under the MIT License
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("chart.js"),require("chart.js/helpers")):"function"==typeof define&&define.amd?define(["exports","chart.js","chart.js/helpers"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).ChartGauge={},e.Chart,e.Chart.helpers)}(this,(function(e,t,r){"use strict";const o={needle:{radius:"10%",width:"15%",length:"80%"},valueLabel:{display:!0,font:void 0,formatter:Math.round,color:()=>"#FFF",backgroundColor:t.Chart.defaults.backgroundColor,borderColor:t.Chart.defaults.borderColor,borderWidth:0,borderRadius:5,padding:{top:5,right:5,bottom:5,left:5},offsetX:0,offsetY:0},animation:{animateRotate:!0,animateScale:!1},cutout:"50%",rotation:-90,circumference:180,value:0,minValue:0};class s extends t.DoughnutController{constructor(e,r){super(e,r),this.center=new t.ArcElement({}),this.values=[],this.valuePercent=0,this.previous=0,this.current=0}_updateMeta(){const e=this._cachedMeta,t=e._parsed;if(this.values=[],this.valuePercent=0,0===t.length)return e;const r=this.options,{value:o=0,minValue:s=0}=r,i=t.length>0?t[t.length-1]:s+1;t.reduce(((e,t)=>(this.values.push(t-e),t)),s);const a=i-s;return this.valuePercent=o/a,e}_getTranslation(){const e=this._cachedMeta.data[0];return null==e?{dx:0,dy:0}:{dx:e.x,dy:e.y}}_getAngle(e){const t=this.options,{rotation:o,circumference:s}=t;return r.toRadians(o+s*e)}_getSize(e){return r.toPercentage(e,this.outerRadius)*this.outerRadius}drawNeedle(){const e=this.options,{ctx:t}=this.chart,{needle:r}=e,{radius:o,width:s,length:i}=r,{color:a}=r,n=this._getSize(o),l=this._getSize(s),d=this._getSize(i),{dx:h,dy:u}=this._getTranslation(),c=this._getAngle(this.center.endAngle);t.save(),t.translate(h,u),t.rotate(c),t.fillStyle=a,t.shadowBlur=12,t.shadowColor=a.toString(),t.beginPath(),t.ellipse(0,0,n,n,0,0,2*Math.PI),t.fill(),t.beginPath(),t.moveTo(-l/2,0),t.lineTo(-l/2,-d),t.arcTo(0,-d-l/2,l/2,-d,l/2),t.lineTo(l/2,-d),t.lineTo(l/2,0),t.fill(),t.shadowBlur=10,t.shadowColor="yellow",t.globalCompositeOperation="overlay",t.fillStyle="rgba(255, 255, 34, 0.3)",t.beginPath(),t.ellipse(0,0,n*(3/4),n*(3/4),0,0,2*Math.PI),t.fill(),t.beginPath(),t.moveTo(-l/4,0),t.lineTo(-l/4,-d),t.arcTo(0,-d-l,l/4,-d,l/4),t.lineTo(l/4,-d),t.lineTo(l/4,0),t.fill(),t.restore()}drawValueLabel(){const e=this.options,{valueLabel:t}=e;if(!t.display)return;const{ctx:o}=this.chart,{color:s,formatter:i,backgroundColor:a,borderColor:n,borderWidth:l,borderRadius:d,padding:h,offsetX:u,offsetY:c}=t,p=r.toFont(t.font),{value:g}=e,f=(i?i(g):g).toString();o.save(),o.textBaseline="middle",o.textAlign="center",o.font=p.string,o.shadowBlur=12,o.shadowColor=s.toString();const{width:b}=o.measureText(f),{lineHeight:v}=p,m=1*v,_=-(h.left+b/2)-l,y=-(h.top+m/2)-l,x=h.left+b+h.right+2*l,C=h.top+m+h.bottom+2*l;let{dx:w,dy:T}=this._getTranslation();w+=this._getSize(u),T+=this._getSize(c)+50,o.translate(w,T),o.fillStyle=a,o.beginPath(),r.addRoundedRectPath(o,{x:_,y:y,w:x,h:C,radius:r.toTRBLCorners(d)}),o.closePath(),o.fill(),l&&(o.strokeStyle=n,o.lineWidth=l,o.stroke());r.renderText(o,f,0,.075*m,p,{textAlign:"center",textBaseline:"middle",color:s}),o.restore()}update(e){const t="reset"===e,r=this._updateMeta();t?(this.previous=0,this.current=0):(this.previous=this.current||0,this.current=this.valuePercent);const o=r._parsed;r._parsed=this.values,super.update(e),r._parsed=o}updateElements(e,t,r,o){const s=this._cachedMeta,i=s._parsed;if(s._parsed=this.values,super.updateElements(e,t,r,o),s._parsed=i,0===e.length)return;const a=e[0];super.updateElement(this.center,void 0,{x:a.x,y:a.y,startAngle:this.previous,endAngle:this.current,circumference:0,outerRadius:100,innerRadius:0,options:{}},o)}draw(){super.draw(),0!==this.values.length&&(this.drawNeedle(),this.drawValueLabel())}}s.id="gauge",s.version="3.0.0",s.defaults=o,s.descriptors={_scriptable:e=>"formatter"!==e},s.overrides={aspectRatio:!1,layout:{padding:{top:10,bottom:80}},plugins:{legend:{display:!1},tooltip:{enabled:!1}}},t.Chart.register(s),t.Chart.register(t.ArcElement),e.GaugeController=s,Object.defineProperty(e,"__esModule",{value:!0})}));
